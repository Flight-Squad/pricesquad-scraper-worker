# For pulling packages from Github Package Registry
apiVersion: v1
kind: Secret
metadata:
    # name must match "imagePullSecrets" key in Deployment below
    name: github-regcred
    namespace: default
data:
    .dockerconfigjson: <DOCKER_CONFIG>
type: kubernetes.io/dockerconfigjson

---
apiVersion: apps/v1
kind: Deployment
metadata:
    name: pricesquad-scraper-worker
    namespace: default
    labels:
        app: pricesquad-scraper-worker
spec:
    replicas: 1
    selector:
        matchLabels:
            app: pricesquad-scraper-worker
    template:
        metadata:
            labels:
                app: pricesquad-scraper-worker
        spec:
            containers:
                - name: pricesquad-scraper-worker
                  image: <IMAGE>
                  env:
                      - name: ENVKEY
                        value: <ENVKEY>
                      - name: NODE_ENV
                        value: <NODE_ENV>
                      - name: NPM_TOKEN
                        value: <NPM_TOKEN>
                  ports:
                      - containerPort: 80
                        name: http
            imagePullSecrets:
                - name: github-regcred

---
apiVersion: v1
kind: Service
metadata:
    name: pricesquad-scraper-worker
    namespace: default
    labels:
        app: pricesquad-scraper-worker
spec:
    type: ClusterIP
    ports:
        - port: 80
          targetPort: http
          name: http
    selector:
        app: pricesquad-scraper-worker
